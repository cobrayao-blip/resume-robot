# Resume-Robot 项目设计文档

## 一、项目定位

**Resume-Robot** 是一个**企业级简历自动化处理SaaS平台**，通过AI技术帮助企业HR快速筛选、匹配和评估简历，提升招聘效率和质量。

### 核心价值
- **效率提升**：自动化处理大量简历，减少90%无效简历处理时间
- **精准匹配**：AI驱动的简历-岗位智能匹配
- **决策支持**：生成结构化推荐报告，辅助用人部门决策
- **SaaS化部署**：支持多租户，企业独立数据空间，便于商业化运营

### 商业模式
- **SaaS订阅模式**：按企业/按用户数/按处理量收费
- **多租户架构**：每个企业独立数据空间，数据完全隔离
- **管理后台**：平台管理员统一管理所有租户

---

## 二、核心业务流程

### 2.1 简化业务流程

```
简历接入 → 预筛选 → 岗位匹配 → 推荐报告生成
   ↓         ↓          ↓            ↓
 上传/邮箱  过滤箱    匹配度标签    Word报告
           低质量简历  强烈推荐/推荐  给用人部门
```

### 2.2 详细流程说明

#### 步骤1：组织架构配置
- **操作**：HR配置公司组织架构（部门层级结构）
- **目的**：为岗位管理提供部门基础，支持不同部门有相同岗位名称

#### 步骤2：岗位创建
- **操作**：HR创建岗位，必须关联部门
- **处理**：
  - 岗位画像解析（LLM解析岗位描述和要求）
  - 岗位向量化
  - 自动生成岗位简历库容器

#### 步骤3：简历接入
- **方式1**：上传到简历总库（通用上传）
  - 手动上传（MVP）、邮箱接收（后续）、ATS集成（后续）
  - 自动解析简历，生成结构化数据
  - 保存到企业简历总库
  
- **方式2**：上传到岗位简历库（从岗位入口上传）
  - 直接关联到特定岗位
  - 自动解析简历
  - 保存到岗位简历库，自动进入匹配流程

#### 步骤4：预筛选
- **目的**：过滤明显不符合要求的简历
- **方式**：HR配置筛选规则（学历、经验、技能等硬门槛）
- **执行时机**：
  - 简历上传后自动执行（如果关联了岗位）
  - 手动触发执行
- **结果**：
  - 不符合规则 → **过滤箱**（低质量简历）
  - 符合规则 → 进入匹配流程

#### 步骤5：岗位匹配
- **输入**：通过预筛选的简历 + 岗位要求 + 公司信息（LLM上下文）
- **处理**：
  - 简历向量化
  - 岗位向量化
  - 计算匹配度（向量相似度 + LLM分析，LLM分析时使用公司信息增强Prompt）
- **输出**：
  - 匹配度分数（0-100分）
  - 匹配标签：**强烈推荐**（≥85分）/ **推荐**（70-84分）/ **谨慎推荐**（60-69分）/ **不推荐**（<60分）

#### 步骤6：推荐报告生成
- **触发**：HR选择匹配度高的简历
- **内容**：
  - 候选人基本信息
  - 匹配度分析（基于公司信息和文化偏好）
  - 优势分析
  - 风险点提示
  - 推荐理由
- **输出**：Word文档，发送给用人部门

---

## 三、系统架构设计（SaaS多租户）

### 3.1 多租户架构

**租户（Tenant）概念**：
- 每个企业是一个独立的租户
- 每个租户拥有独立的数据空间（组织架构、岗位、简历、匹配记录等）
- 数据完全隔离，互不干扰

**数据隔离策略**：
- **数据库级别**：每个租户有独立的数据库schema（可选，适合大型企业）
- **应用级别**：所有表增加 `tenant_id` 字段，查询时自动过滤（推荐，适合SaaS）

**租户管理**：
- 租户注册与激活
- 租户订阅管理（套餐、到期时间）
- 租户数据统计与监控

---

## 四、核心模块设计

### 模块0：租户管理（Tenant Management）

**职责**：管理SaaS平台的多租户

**核心功能**：
- 租户注册与激活
- 租户信息管理
- 租户订阅管理（套餐、到期时间、使用量）
- 租户数据统计

**数据模型**：
- `Tenant`：租户信息（PostgreSQL）
  - id, name, domain, contact_email, contact_phone
  - subscription_plan (trial/basic/professional/enterprise)
  - subscription_start, subscription_end
  - status (active/suspended/expired)
  - max_users, max_jobs, max_resumes_per_month
  - current_month_resume_count
  - created_at, updated_at

**API设计**（管理后台）：
```
POST   /api/v1/admin/tenants              # 创建租户
PUT    /api/v1/admin/tenants/{id}         # 更新租户
GET    /api/v1/admin/tenants              # 查询租户列表
GET    /api/v1/admin/tenants/{id}         # 获取租户详情
POST   /api/v1/admin/tenants/{id}/activate # 激活租户
POST   /api/v1/admin/tenants/{id}/suspend  # 暂停租户
GET    /api/v1/admin/tenants/{id}/stats    # 租户数据统计
```

---

### 模块0.1：组织架构管理（Organization Management）

**职责**：管理公司组织架构，支持多层级部门结构

**核心功能**：
- 部门创建与编辑
- 部门层级管理（支持多级部门）
- 部门查询与搜索

**数据模型**：
- `Department`：部门信息（PostgreSQL）
  - id, name, code, parent_id (上级部门ID)
  - level (部门层级), path (部门路径，如：公司/技术部/后端组)
  - description, manager_id
  - created_at, updated_at

**API设计**：
```
POST   /api/v1/organization/departments         # 创建部门
PUT    /api/v1/organization/departments/{id}    # 更新部门
GET    /api/v1/organization/departments         # 查询部门列表（树形结构）
GET    /api/v1/organization/departments/{id}    # 获取部门详情
DELETE /api/v1/organization/departments/{id}    # 删除部门
```

---

### 模块1：简历管理（Resume Management）

**职责**：管理简历的接入、解析、存储

**核心概念**：
- **简历总库**：企业所有简历的统一存储库
- **岗位简历库**：特定岗位的简历集合，用于该岗位的匹配

**核心功能**：
- 简历上传（单文件/批量）
  - 上传到简历总库（通用上传）
  - 上传到岗位简历库（从岗位入口上传，直接关联岗位）
- 简历解析（PDF/Word → 结构化数据）
- 简历查询与搜索
  - 简历总库查询
  - 岗位简历库查询
- 简历去重
- 简历关联（将总库简历关联到岗位简历库）

**数据模型**：
- `Resume`：简历基本信息（PostgreSQL）
  - id, tenant_id (租户ID，SaaS隔离), user_id, file_name, file_path, file_hash
  - parsed_data (JSON), candidate_name, candidate_email
  - status (pending/parsed/filtered/matched)
  - source_type (talent_pool/job_pool) # 来源：总库/岗位库
  - created_at, updated_at
  
- `JobResume`：岗位简历关联（PostgreSQL）
  - id, tenant_id (租户ID，SaaS隔离), job_id, resume_id
  - status (pending/filtered/matched/rejected)
  - filter_result (JSON), match_result (JSON)
  - created_at, updated_at
  
- `ResumeDocument`：简历解析详情（MongoDB）
  - resume_id, parsed_data (完整结构化数据)
  - raw_text, created_at

- `ResumeVector`：简历向量（Milvus）
  - resume_id, vector (768维)

**API设计**：
```
POST   /api/v1/resumes/upload                    # 上传到简历总库
POST   /api/v1/resumes/batch-upload              # 批量上传到简历总库
POST   /api/v1/jobs/{job_id}/resumes/upload      # 上传到岗位简历库
POST   /api/v1/jobs/{job_id}/resumes/batch-upload # 批量上传到岗位简历库
GET    /api/v1/resumes                          # 查询简历总库
GET    /api/v1/jobs/{job_id}/resumes            # 查询岗位简历库
GET    /api/v1/resumes/{id}                     # 获取简历详情
POST   /api/v1/resumes/{id}/parse               # 解析简历
POST   /api/v1/jobs/{job_id}/resumes/{resume_id}/link # 将总库简历关联到岗位
DELETE /api/v1/resumes/{id}                     # 删除简历
```

---

### 模块2：组织架构管理（Organization Management）

**职责**：管理公司组织架构，支持多层级部门结构

**核心功能**：
- 部门创建与编辑
- 部门层级管理（支持多级部门）
- 部门查询与搜索

**数据模型**：
- `Department`：部门信息（PostgreSQL）
  - id, name, code, parent_id (上级部门ID)
  - level (部门层级), path (部门路径，如：公司/技术部/后端组)
  - description, manager_id
  - created_at, updated_at

**API设计**：
```
POST   /api/v1/organization/departments         # 创建部门
PUT    /api/v1/organization/departments/{id}    # 更新部门
GET    /api/v1/organization/departments         # 查询部门列表（树形结构）
GET    /api/v1/organization/departments/{id}    # 获取部门详情
DELETE /api/v1/organization/departments/{id}    # 删除部门
```

---

### 模块3：岗位管理（Job Management）

**职责**：管理岗位信息、岗位要求、岗位简历库

**核心功能**：
- 岗位创建与编辑（必须关联部门）
- 岗位发布（自动生成岗位简历库容器）
- 岗位画像解析（LLM解析岗位描述和要求）
- 岗位向量化
- 岗位简历库管理（查看该岗位的简历列表）

**数据模型**：
- `Job`：岗位基本信息（PostgreSQL）
  - id, tenant_id (租户ID，SaaS隔离), title, department_id (关联部门)
  - description, requirements, status (draft/published/closed)
  - created_by, created_at, updated_at
  
- `JobProfile`：岗位画像（MongoDB）
  - job_id, parsed_data (结构化岗位要求)
  - raw_description, raw_requirements
  
- `JobVector`：岗位向量（Milvus）
  - job_id, vector (768维)

**API设计**：
```
POST   /api/v1/jobs                    # 创建岗位（必须指定department_id）
PUT    /api/v1/jobs/{id}              # 更新岗位
GET    /api/v1/jobs                   # 查询岗位列表（可按部门筛选）
GET    /api/v1/jobs/{id}              # 获取岗位详情
POST   /api/v1/jobs/{id}/publish      # 发布岗位（生成岗位简历库）
POST   /api/v1/jobs/{id}/parse        # 解析岗位画像
GET    /api/v1/jobs/{id}/resumes      # 查询岗位简历库
DELETE /api/v1/jobs/{id}              # 删除岗位
```

---

### 模块4：预筛选引擎（Pre-filter Engine）

**职责**：执行硬门槛筛选，过滤低质量简历

**核心功能**：
- 筛选规则配置
- 自动执行预筛选
- 过滤箱管理

**数据模型**：
- `FilterRule`：筛选规则（PostgreSQL）
  - id, tenant_id (租户ID，SaaS隔离), name, rule_type
  - rule_config (JSON), priority, is_active
  - created_by, created_at
  
- `FilterResult`：筛选结果（PostgreSQL）
  - id, resume_id, rule_id
  - passed (boolean), reason
  - created_at

**规则类型**：
- `education`：学历要求（最低学历、专业）
- `experience`：经验要求（最低年限、相关领域）
- `skill`：技能要求（必须技能列表）
- `age`：年龄要求（年龄范围）
- `location`：地点要求（工作地点、居住地）

**API设计**：
```
POST   /api/v1/filters/rules          # 创建规则
PUT    /api/v1/filters/rules/{id}     # 更新规则
GET    /api/v1/filters/rules          # 查询规则列表
DELETE /api/v1/filters/rules/{id}     # 删除规则
POST   /api/v1/filters/execute        # 执行单个简历筛选
POST   /api/v1/filters/batch-execute  # 批量执行筛选
GET    /api/v1/filters/filtered       # 查询过滤箱（被过滤的简历）
```

---

### 模块5：匹配系统（Matching System）

**职责**：简历与岗位的智能匹配

**核心功能**：
- 简历向量化
- 岗位向量化
- 匹配度计算
- 匹配标签生成

**匹配算法**：
- **向量相似度**（70%权重）：基于简历和岗位的向量相似度
- **LLM深度分析**（30%权重）：LLM综合评估匹配度

**数据模型**：
- `Match`：匹配记录（PostgreSQL）
  - id, tenant_id (租户ID，SaaS隔离), resume_id, job_id
  - match_score (0-100), match_label (强烈推荐/推荐/谨慎推荐/不推荐)
  - status (pending/reviewed/accepted/rejected)
  - created_at, updated_at
  
- `MatchDetail`：匹配详情（MongoDB）
  - match_id, resume_id, job_id
  - vector_similarity, llm_analysis (JSON)
  - strengths, weaknesses, risk_points
  - created_at

**API设计**：
```
POST   /api/v1/matches/resume-to-job  # 单个简历匹配
POST   /api/v1/matches/batch-match    # 批量匹配
GET    /api/v1/matches                # 查询匹配结果
GET    /api/v1/matches/{id}           # 获取匹配详情
PUT    /api/v1/matches/{id}/status    # 更新匹配状态
```

---

### 模块6：推荐报告（Recommendation Report）

**职责**：生成结构化推荐报告

**核心功能**：
- 报告生成（单个/批量）
- Word文档导出
- 报告历史管理

**报告内容结构**：
1. 候选人基本信息
2. 匹配度分析（分数 + 各维度得分）
3. 优势分析（3-5条）
4. 劣势分析（2-3条）
5. 风险点提示（1-3条）
6. 推荐理由

**数据模型**：
- `Report`：报告记录（PostgreSQL）
  - id, tenant_id (租户ID，SaaS隔离), match_id, resume_id, job_id
  - report_data (JSON), file_path
  - created_by, created_at

**API设计**：
```
POST   /api/v1/reports/generate       # 生成单个报告
POST   /api/v1/reports/batch-generate # 批量生成报告
GET    /api/v1/reports/{id}          # 获取报告详情
GET    /api/v1/reports/{id}/download # 下载Word文档
```

---

### 模块7：公司信息（Company Info）

**职责**：管理公司信息，用于LLM匹配时的上下文增强

**核心功能**：
- 公司信息配置（行业、产品、应用场景、文化、偏好）
- 信息用于LLM Prompt增强（在匹配和报告生成时使用）

**数据模型**：
- `CompanyInfo`：公司信息（PostgreSQL，每个租户单例）
  - id, tenant_id (租户ID，SaaS隔离), name, industry, products
  - application_scenarios, company_culture, preferences
  - updated_by, updated_at

**LLM Prompt增强**：
- 在岗位匹配时，将公司信息作为上下文注入Prompt
- 在推荐报告生成时，基于公司文化和偏好进行分析
- 帮助LLM更好地理解岗位要求和候选人匹配度

**API设计**：
```
GET    /api/v1/company/info           # 获取公司信息
PUT    /api/v1/company/info          # 更新公司信息
```

---

## 八、数据存储架构

### 4.1 三层数据库协同

#### PostgreSQL（关系型数据库）
**存储**：
- 用户信息
- 组织架构（部门信息）
- 简历基本信息
- 岗位基本信息
- 岗位简历关联（JobResume）
- 筛选规则
- 匹配记录
- 报告记录
- 公司信息

**特点**：结构化数据，支持复杂查询和事务

#### MongoDB（文档数据库）
**存储**：
- 简历解析详情（`resume_documents`）
- 岗位画像详情（`job_profiles`）
- 匹配详情（`match_details`）

**特点**：灵活schema，存储非结构化数据

#### Milvus（向量数据库）
**存储**：
- 简历向量（`resume_vectors`）
- 岗位向量（`job_vectors`）

**特点**：支持向量相似度搜索

---

## 九、技术架构

### 5.1 后端技术栈
- **框架**：FastAPI
- **ORM**：SQLAlchemy
- **数据库**：PostgreSQL + MongoDB + Milvus
- **缓存**：Redis
- **LLM**：DeepSeek（主要）、千问（备选）

### 5.2 前端技术栈
- **框架**：React + TypeScript
- **UI库**：Ant Design
- **状态管理**：Zustand
- **路由**：React Router
- **HTTP客户端**：Axios

### 5.3 部署架构
- **容器化**：Docker + Docker Compose
- **数据库**：PostgreSQL、MongoDB、Milvus、Redis
- **对象存储**：MinIO（Milvus依赖）

---

## 十、MVP功能范围

### 6.1 必须实现（核心功能）

#### 1. 组织架构管理
- ✅ 部门创建
- ✅ 部门编辑
- ✅ 部门树形结构查询

#### 2. 简历管理
- ✅ 简历上传（单文件/批量）
  - 上传到简历总库
  - 上传到岗位简历库（从岗位入口）
- ✅ 简历解析（PDF/Word → 结构化数据）
- ✅ 简历总库查询
- ✅ 岗位简历库查询
- ✅ 简历详情查看

#### 3. 岗位管理
- ✅ 岗位创建（必须关联部门）
- ✅ 岗位编辑
- ✅ 岗位发布（自动生成岗位简历库）
- ✅ 岗位列表查询（可按部门筛选）
- ✅ 岗位画像解析（LLM）

#### 4. 预筛选
- ✅ 筛选规则配置（学历、经验、技能）
- ✅ 单个简历筛选执行
- ✅ 批量简历筛选执行
- ✅ 过滤箱查看（被过滤的简历）

#### 5. 匹配系统
- ✅ 简历向量化
- ✅ 岗位向量化
- ✅ 简历-岗位匹配（单个）
- ✅ 批量匹配（岗位简历库批量匹配）
- ✅ 匹配结果查看
- ✅ 匹配标签生成（使用公司信息增强LLM分析）

#### 6. 推荐报告
- ✅ 单个报告生成
- ✅ 批量报告生成
- ✅ Word文档导出

#### 7. 公司信息
- ✅ 公司信息配置（用于LLM Prompt增强）
- ✅ 公司信息查看

### 6.2 可选实现（增强功能）
- ⚠️ 匹配结果统计
- ⚠️ 数据可视化（匹配度分布、标签分布）
- ⚠️ 简历标签管理

### 6.3 后续扩展（第二阶段）
- 📋 邮箱自动接收简历
- 📋 ATS系统集成
- 📋 更复杂的匹配算法
- 📋 面试反馈与跟踪

---

## 七、前端页面结构

### 7.1 主要页面

#### 1. 组织架构页面
- 部门树形结构
- 部门创建/编辑
- 部门详情

#### 2. 简历管理页面
- **简历总库**：
  - 简历列表（表格）
  - 简历上传（拖拽上传）
  - 简历详情（查看解析结果）
- **岗位简历库**：
  - 岗位简历列表（按岗位分组）
  - 从岗位入口上传简历
  - 简历详情
- **过滤箱**：
  - 被过滤的简历列表

#### 3. 岗位管理页面
- 岗位列表（表格，可按部门筛选）
- 岗位创建/编辑（表单，必须选择部门）
- 岗位详情（查看岗位画像）
- 岗位简历库（该岗位的简历列表）
- 从岗位入口上传简历（直接进入岗位简历库）

#### 3. 匹配结果页面
- 匹配列表（按岗位分组）
- 匹配详情（查看匹配分析）
- 筛选（按匹配标签、岗位）

#### 4. 推荐报告页面
- 报告列表
- 报告生成（选择简历生成报告）
- 报告下载

#### 5. 系统设置页面
- 公司信息配置（用于LLM Prompt增强）
- 组织架构管理
- 筛选规则管理

---

## 十一、关键设计原则

### 8.1 简化优先
- 聚焦核心功能，避免过度设计
- MVP阶段只实现必要功能
- 后续功能按需扩展

### 8.2 自动化优先
- 尽可能自动化处理（解析、筛选、匹配）
- 减少人工操作步骤
- 批量操作支持

### 8.3 数据驱动
- 所有决策基于数据（匹配度、评分）
- 提供清晰的匹配分析
- 支持数据统计和趋势分析

---

## 十二、数据流设计

### 9.1 简历处理流程

```
方式1：上传到简历总库
简历上传（总库）
  ↓
简历解析（LLM）
  ↓
保存到简历总库
  ↓
[可选] 关联到岗位 → 进入岗位简历库

方式2：上传到岗位简历库
从岗位入口上传简历
  ↓
简历解析（LLM）
  ↓
保存到岗位简历库
  ↓
预筛选（规则引擎）
  ↓
[不符合] → 过滤箱
[符合]   → 岗位匹配
  ↓
匹配度计算（使用公司信息增强LLM Prompt）
  ↓
生成匹配标签
  ↓
[匹配度高] → 生成推荐报告
```

### 9.2 岗位匹配流程

```
组织架构配置
  ↓
岗位创建（关联部门）
  ↓
岗位画像解析（LLM）
  ↓
岗位向量化
  ↓
简历向量化
  ↓
向量相似度计算（Milvus）
  ↓
LLM深度分析（使用公司信息增强Prompt）
  ↓
匹配度计算（加权融合）
  ↓
生成匹配标签
```

---

## 十三、API设计原则

### 10.1 RESTful设计
- 使用标准HTTP方法（GET/POST/PUT/DELETE）
- 资源导向的URL设计
- 统一的响应格式

### 10.2 响应格式
```json
{
  "success": true,
  "data": {...},
  "message": "操作成功"
}
```

### 10.3 错误处理
```json
{
  "success": false,
  "code": 400,
  "message": "错误消息",
  "details": {...}
}
```

---

## 十四、SaaS部署架构

### 14.1 多租户数据隔离

**策略**：应用级别隔离（推荐）
- 所有业务表增加 `tenant_id` 字段
- 中间件自动注入 `tenant_id` 到查询条件
- 用户登录后，从JWT Token中获取 `tenant_id`
- 所有数据查询自动过滤 `tenant_id`

**实现方式**：
```python
# 中间件自动注入 tenant_id
@app.middleware("http")
async def tenant_middleware(request: Request, call_next):
    # 从JWT Token中提取 tenant_id
    tenant_id = get_tenant_from_token(request)
    # 设置到请求上下文
    request.state.tenant_id = tenant_id
    response = await call_next(request)
    return response

# 数据库查询自动过滤
def get_db():
    db = SessionLocal()
    # 自动添加 tenant_id 过滤条件
    return db
```

### 14.2 租户订阅管理

**订阅套餐**：
- **Trial（试用版）**：免费，限制功能和使用量
- **Basic（基础版）**：按月/年付费，基础功能
- **Professional（专业版）**：按月/年付费，完整功能
- **Enterprise（企业版）**：按年付费，定制化服务

**使用量限制**：
- 最大用户数
- 最大岗位数
- 每月最大简历处理量
- 存储空间限制

### 14.3 管理后台功能

**平台管理员功能**：
1. **租户管理**
   - 创建/编辑/删除租户
   - 租户激活/暂停
   - 租户数据统计

2. **订阅管理**
   - 套餐配置
   - 订阅续费
   - 使用量监控

3. **系统配置**
   - LLM服务配置（API密钥管理）
   - 系统参数配置
   - 功能开关

4. **数据统计**
   - 平台整体数据
   - 租户使用分析
   - 收入统计

### 14.4 用户权限体系

**角色定义**：
- **平台管理员**：管理所有租户，系统配置
- **租户管理员**：管理租户内的组织架构、公司信息、用户
- **HR用户**：处理简历、岗位管理、匹配、报告生成

**权限控制**：
- 基于角色的访问控制（RBAC）
- API级别权限验证
- 前端路由权限控制

---

## 十五、总结

### 11.1 核心价值
**Resume-Robot** 通过AI自动化处理简历，帮助企业HR：
- 快速筛选出符合要求的简历
- 精准匹配简历与岗位
- 生成结构化推荐报告，辅助决策

### 11.2 关键特性
- **自动化**：简历解析、筛选、匹配全自动
- **智能化**：AI驱动的匹配算法
- **批量化**：支持批量处理，提高效率
- **结构化**：清晰的业务流程和数据模型

### 11.3 成功标准
- HR可以快速筛选出符合要求的简历（预筛选效率提升90%）
- 系统能够准确匹配简历与岗位（匹配度≥70%的准确率≥80%）
- 生成的推荐报告对用人部门有参考价值
- 整体处理效率提升80%以上

