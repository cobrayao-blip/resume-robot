# 简历解析JSON结构和Schema说明

本文档详细说明了简历解析后的JSON数据结构和相关的Schema定义。

## 一、解析后的JSON结构（parsed_data）

### 完整结构

```json
{
  "basic_info": {
    "name": "string",
    "phone": "string",
    "email": "string",
    "location": "string",
    "gender": "string|null",
    "birth_date": "string|null",
    "birthday": "string|null",
    "hometown": "string|null",
    "marital_status": "string|null",
    "family_location": "string|null",
    "current_location": "string|null",
    "current_work_location": "string|null",
    "wechat": "string|null",
    "onboard_date": "string|null",
    "other_info": "string|null"
  },
  "work_experiences": [
    {
      "company": "string",
      "position": "string",
      "location": "string|null",
      "start_date": "string",
      "end_date": "string|null",
      "is_current": true/false,
      "report_to": "string|null",
      "team_size": "string|null",
      "responsibilities": ["string"],
      "achievements": ["string"],
      "reason_for_leaving": "string|null"
    }
  ],
  "education": [
    {
      "school": "string",
      "major": "string",
      "education_level": "string",
      "degree": "string|null",
      "start_date": "string|null",
      "graduation_date": "string|null"
    }
  ],
  "skills": {
    "technical": ["string"],
    "soft": ["string"],
    "languages": ["string"]
  },
  "projects": [
    {
      "name": "string",
      "role": "string|null",
      "start_date": "string|null",
      "end_date": "string|null",
      "description": "string",
      "responsibilities": ["string"],
      "achievements": ["string"],
      "related_work": "string|null"
    }
  ],
  "_metadata": {
    "parsing_version": "2.0"
  }
}
```

## 二、字段详细说明

### 1. basic_info（基本信息）

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `name` | string | 是 | 姓名 | "张三" |
| `phone` | string | 是 | 电话 | "13800138000" |
| `email` | string | 是 | 邮箱 | "zhangsan@example.com" |
| `location` | string | 是 | 所在地 | "北京" |
| `gender` | string\|null | 否 | 性别 | "男" / "女" |
| `birth_date` | string\|null | 否 | 出生日期 | "1990-05" / "1990.05" |
| `birthday` | string\|null | 否 | 出生日期（兼容字段） | 与 birth_date 相同 |
| `hometown` | string\|null | 否 | 籍贯 | "山东" |
| `marital_status` | string\|null | 否 | 婚育状态 | "已婚" / "未婚" / "已婚已育" |
| `family_location` | string\|null | 否 | 家庭所在地 | "上海" |
| `current_location` | string\|null | 否 | 现工作地 | "深圳" |
| `current_work_location` | string\|null | 否 | 现工作地（兼容字段） | 与 current_location 相同 |
| `wechat` | string\|null | 否 | 微信号 | "wxid_xxx" |
| `onboard_date` | string\|null | 否 | 入职时间 | "2024-01" |
| `other_info` | string\|null | 否 | 其他信息 | "持有PMP证书" |

**重要说明**：
- 所有个人信息字段必须直接放在 `basic_info` 顶层，禁止放在嵌套对象中
- `birthday` 和 `current_work_location` 是兼容字段，与 `birth_date` 和 `current_location` 含义相同

### 2. work_experiences（工作经历）

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `company` | string | 是 | 公司名称（完整公司名） | "中国建筑第八工程局有限公司" |
| `position` | string | 是 | 职位名称 | "业务经理" / "金融业务部 业务经理" |
| `location` | string\|null | 否 | 工作地点 | "北京" |
| `start_date` | string | 是 | 开始时间（格式：YYYY-MM） | "2019-04" |
| `end_date` | string\|null | 否 | 结束时间（格式：YYYY-MM） | "2022-06"；如在职则为 null |
| `is_current` | boolean | 是 | 是否当前工作 | true / false |
| `report_to` | string\|null | 否 | 汇报对象 | "部门总监" |
| `team_size` | string\|null | 否 | 团队规模 | "10人" |
| `responsibilities` | string[] | 是 | 工作职责数组 | ["负责项目投融资", "管理金融产品"] |
| `achievements` | string[] | 是 | 工作业绩数组 | ["完成XX项目，获得XX奖励"] |
| `reason_for_leaving` | string\|null | 否 | 离职原因 | "个人发展" |

**重要说明**：
- **时间格式识别**：必须识别多种时间格式并转换为标准格式 YYYY-MM
  - `2019/4—2022/6` → `start_date: "2019-04", end_date: "2022-06"`
  - `2019.4-2022.6` → `start_date: "2019-04", end_date: "2022-06"`
  - `2019年4月-2022年6月` → `start_date: "2019-04", end_date: "2022-06"`
  - 如果月份是单数字，必须补零为"04"（即"2019-04"）
- **职责和业绩**：
  - 每个数组元素必须是一条完整的职责/业绩描述
  - 禁止按逗号、顿号过度拆分
  - 必须完整提取所有职责内容，不要因为内容长而截断或忽略
  - **派遣经历**：如果工作职责中包含派遣经历，必须保留时间信息
    - 格式：`"【YYYY.MM-YYYY.MM】派遣到XX公司/单位，具体工作内容..."`
    - 例如：`"【2019.09-2019.12】派遣到钜芯集成电路测试SMIC新0.13 BCD工艺，完成Motor Driver和Test Chip十余个版本..."`
- **职位信息**：如果职位包含部门信息（如"金融业务部 业务经理"），可以保留完整信息，或只提取职位部分（"业务经理"）

### 3. education（教育背景）

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `school` | string | 是 | 学校名称 | "清华大学" |
| `major` | string | 是 | 专业 | "计算机科学与技术" |
| `education_level` | string | 是 | 学历层次 | "研究生" / "本科" / "专科" / "高中" |
| `degree` | string\|null | 否 | 学位 | "学士" / "硕士" / "博士" |
| `start_date` | string\|null | 否 | 入学时间 | "2016-09" |
| `graduation_date` | string\|null | 否 | 毕业时间 | "2020-06" |

**重要说明**：
- **education_level（学历层次）**：指教育层次，如"研究生"、"本科"、"专科"、"高中"、"中专"等
  - **注意**："硕士"、"博士"不是学历层次，而是学位！
- **degree（学位）**：指学术学位，如"学士"、"硕士"、"博士"等
- **区分规则**：
  - 如果简历中写"本科"，应填入 `education_level="本科"`，`degree` 可为空或推断为"学士"
  - 如果简历中写"硕士"，应填入 `education_level="研究生"`（如果明确提到研究生阶段）或为空，`degree="硕士"`
  - 如果简历中写"博士"，应填入 `education_level="研究生"`（如果明确提到研究生阶段）或为空，`degree="博士"`
  - **关键**：绝对不要把"硕士"、"博士"填入 `education_level` 字段！

### 4. skills（技能专长）

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `technical` | string[] | 是 | 技术技能数组 | ["Java", "Python", "Spring Boot"] |
| `soft` | string[] | 是 | 软技能数组 | ["团队协作", "沟通能力"] |
| `languages` | string[] | 是 | 语言能力数组 | ["英语（CET-6）", "日语（N2）"] |

### 5. projects（项目经历）

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `name` | string | 是 | 项目名称 | "XX系统开发" |
| `role` | string\|null | 否 | 项目角色 | "KAM" / "项目经理" / "技术负责人" |
| `start_date` | string\|null | 否 | 项目开始时间 | "2020-01" |
| `end_date` | string\|null | 否 | 项目结束时间 | "2021-06"；如进行中可为空 |
| `description` | string | 是 | 项目完整描述 | "项目背景、目的、职责、业绩等" |
| `responsibilities` | string[] | 是 | 项目职责数组 | ["负责系统架构设计", "管理开发团队"] |
| `achievements` | string[] | 是 | 项目业绩数组 | ["完成XX功能，获得XX奖励"] |
| `related_work` | string\|null | 否 | 关联工作 | "与XX公司合作" |

**重要说明**：
- **项目描述（description）**：
  - 使用一段长文本，保持原始语义流畅
  - 如果项目描述中包含了"项目职责"、"项目业绩"等结构化内容，必须：
    - 将"项目职责"部分提取出来，填充到 `responsibilities` 数组
    - 将"项目业绩"部分提取出来，填充到 `achievements` 数组
    - **从 description 中移除已提取的职责和业绩内容**，description 只保留背景、目的、项目概述等非结构化描述
- **项目角色（role）**：
  - 填写项目角色（如"项目经理"、"KAM"、"技术负责人"等）
  - **绝对不要将 role 填充到 responsibilities 中**

### 6. _metadata（元数据）

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `parsing_version` | string | 是 | 解析版本 | "2.0" |

## 三、Schema定义（Pydantic模型）

### 1. ResumeData（简历数据）

**位置**：`backend/app/schemas/resume.py`

```python
class ResumeData(BaseModel):
    basic_info: Dict[str, Any]
    work_experiences: List[Dict[str, Any]]
    education: List[Dict[str, Any]]
    skills: Dict[str, Any]
    projects: List[Dict[str, Any]]
    # 可选扩展：推荐岗位、评价、薪资
    recommended_jobs: Optional[List[Dict[str, Any]]] = None
    evaluation: Optional[Dict[str, Any]] = None
    salary: Optional[Dict[str, Any]] = None
```

**说明**：
- 这是用于简历生成和填充的数据结构
- 包含必填字段和可选扩展字段

### 2. ParsedResumeCreate（解析结果创建）

**位置**：`backend/app/schemas/resume.py`

```python
class ParsedResumeCreate(BaseModel):
    name: str
    parsed_data: Dict[str, Any]  # 存储解析后的JSON数据
    raw_text: Optional[str] = None
    candidate_name: Optional[str] = None
    source_file_name: Optional[str] = None
    source_file_type: Optional[str] = None
    source_file_path: Optional[str] = None
    file_hash: Optional[str] = None
    validation: Optional[Dict[str, Any]] = None
    correction: Optional[Dict[str, Any]] = None
    quality_analysis: Optional[Dict[str, Any]] = None
```

**说明**：
- `parsed_data` 字段存储完整的解析结果JSON
- 包含原始文本、验证结果、纠错结果、质量分析等元数据

### 3. ParsedResumeResponse（解析结果响应）

**位置**：`backend/app/schemas/resume.py`

```python
class ParsedResumeResponse(BaseModel):
    id: int
    user_id: int
    name: str
    parsed_data: Dict[str, Any]  # 解析后的JSON数据
    raw_text: Optional[str] = None
    candidate_name: Optional[str] = None
    source_file_name: Optional[str] = None
    source_file_type: Optional[str] = None
    source_file_path: Optional[str] = None
    file_hash: Optional[str] = None
    validation: Optional[Dict[str, Any]] = None
    correction: Optional[Dict[str, Any]] = None
    quality_analysis: Optional[Dict[str, Any]] = None
    created_at: datetime
    updated_at: datetime
```

## 四、数据库存储结构

### ParsedResume 表

**表名**：`parsed_resumes`

**字段**：
- `id`: Integer（主键）
- `user_id`: Integer（用户ID）
- `name`: String（解析结果名称）
- `parsed_data`: JSON（**存储解析后的JSON数据**）
- `raw_text`: Text（原始文本内容）
- `candidate_name`: String（候选人姓名）
- `source_file_name`: String（源文件名）
- `source_file_type`: String（源文件类型）
- `source_file_path`: String（源文件路径）
- `file_hash`: String（文件哈希）
- `validation`: JSON（验证结果）
- `correction`: JSON（纠错结果）
- `quality_analysis`: JSON（质量分析结果）
- `created_at`: DateTime（创建时间）
- `updated_at`: DateTime（更新时间）

**说明**：
- `parsed_data` 字段以JSON格式存储完整的解析结果
- 包含 `basic_info`、`work_experiences`、`education`、`skills`、`projects` 等所有字段

## 五、解析方法

### parse_resume_text_v2（基础解析）

**位置**：`backend/app/services/llm_service.py`

**方法签名**：
```python
async def parse_resume_text_v2(self, raw_text: str, user=None, db_session=None) -> Dict[str, Any]
```

**功能**：
- 解析简历文本为结构化数据
- 输出稳定、结构清晰的基础解析结果
- 用于后续简历生成和填充

**返回**：
- 返回符合上述JSON结构的字典

### parse_resume_text（增强解析）

**位置**：`backend/app/services/llm_service.py`

**方法签名**：
```python
async def parse_resume_text(self, raw_text: str) -> Dict[str, Any]
```

**功能**：
- 增强解析，包含更多推断信息
- 输出更丰富的结构化数据

## 六、数据流转

### 1. 简历文件上传 → 解析

```
用户上传简历文件（PDF/Word）
  ↓
提取文本内容（raw_text）
  ↓
调用 parse_resume_text_v2(raw_text)
  ↓
返回 parsed_data（JSON结构）
  ↓
保存到数据库（parsed_resumes.parsed_data）
```

### 2. 解析结果 → 简历生成

```
从数据库读取 parsed_data
  ↓
调用 fill_template_with_resume_data(template_structure, parsed_data)
  ↓
使用字段映射规则填充模板
  ↓
生成填充后的简历数据（resume_data）
  ↓
保存到数据库（candidate_resumes.resume_data）
```

## 七、示例数据

### 完整的parsed_data示例

```json
{
  "basic_info": {
    "name": "张三",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "location": "北京",
    "gender": "男",
    "birth_date": "1990-05",
    "hometown": "山东",
    "marital_status": "已婚",
    "current_location": "北京",
    "wechat": "wxid_xxx"
  },
  "work_experiences": [
    {
      "company": "中国建筑第八工程局有限公司",
      "position": "业务经理",
      "location": "北京",
      "start_date": "2019-04",
      "end_date": "2022-06",
      "is_current": false,
      "report_to": "部门总监",
      "team_size": "10人",
      "responsibilities": [
        "负责项目投融资工作",
        "管理金融产品开发和推广",
        "【2019.09-2019.12】派遣到钜芯集成电路测试SMIC新0.13 BCD工艺，完成Motor Driver和Test Chip十余个版本"
      ],
      "achievements": [
        "完成XX项目，获得XX奖励",
        "提升团队效率30%"
      ],
      "reason_for_leaving": "个人发展"
    }
  ],
  "education": [
    {
      "school": "清华大学",
      "major": "计算机科学与技术",
      "education_level": "本科",
      "degree": "学士",
      "start_date": "2016-09",
      "graduation_date": "2020-06"
    }
  ],
  "skills": {
    "technical": ["Java", "Python", "Spring Boot", "MySQL"],
    "soft": ["团队协作", "沟通能力", "项目管理"],
    "languages": ["英语（CET-6）", "日语（N2）"]
  },
  "projects": [
    {
      "name": "XX系统开发",
      "role": "项目经理",
      "start_date": "2020-01",
      "end_date": "2021-06",
      "description": "负责XX系统的整体架构设计和开发，系统上线后获得用户好评",
      "responsibilities": [
        "负责系统架构设计",
        "管理开发团队",
        "协调各方资源"
      ],
      "achievements": [
        "完成XX功能，获得XX奖励",
        "系统性能提升50%"
      ]
    }
  ],
  "_metadata": {
    "parsing_version": "2.0"
  }
}
```

## 八、注意事项

### 1. 时间格式

- **标准格式**：YYYY-MM（如 "2019-04"）
- **必须识别多种格式**：`2019/4`、`2019.4`、`2019年4月` 等
- **月份补零**：单数字月份必须补零（如 "4" → "04"）

### 2. 数组字段

- `responsibilities`、`achievements`：每个元素必须是一条完整的描述
- 禁止过度拆分：不要按逗号、顿号过度拆分
- 必须完整提取：不要因为内容长而截断或忽略

### 3. 字段区分

- **education_level vs degree**：
  - `education_level`：学历层次（本科、研究生、专科等）
  - `degree`：学位（学士、硕士、博士等）
  - 绝对不要把"硕士"、"博士"填入 `education_level`！

### 4. 派遣经历

- 如果工作职责中包含派遣经历，必须保留时间信息
- 格式：`"【YYYY.MM-YYYY.MM】派遣到XX公司/单位，具体工作内容..."`

### 5. 项目描述

- 如果项目描述中包含"项目职责"、"项目业绩"，必须提取到对应数组
- 从 `description` 中移除已提取的内容，只保留背景、目的、项目概述

## 九、相关文件

- **Schema定义**：`backend/app/schemas/resume.py`
- **解析方法**：`backend/app/services/llm_service.py` - `parse_resume_text_v2`
- **数据库模型**：`backend/app/models/resume.py` - `ParsedResume`
- **解析服务**：`backend/app/services/resume_parser.py`

