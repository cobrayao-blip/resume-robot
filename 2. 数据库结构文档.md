# ResumeAI Platform - æ•°æ®åº“ç»“æ„æ–‡æ¡£

**æ•°æ®åº“ç±»å‹**: PostgreSQL 15  
**æœ€åæ›´æ–°**: 2025-12-05

---

## ğŸ“Š æ•°æ®è¡¨æ€»è§ˆ

é¡¹ç›®å…±åŒ…å« **7 ä¸ªä¸šåŠ¡è¡¨**ï¼ˆä¸åŒ…æ‹¬ `alembic_version` ç³»ç»Ÿè¡¨ï¼‰ï¼š

| åºå· | è¡¨å | ä¸­æ–‡åç§° | è¯´æ˜ |
|------|------|----------|------|
| 1 | `users` | ç”¨æˆ·è¡¨ | å­˜å‚¨ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ |
| 2 | `resume_templates` | ç®€å†æ¨¡æ¿è¡¨ | å­˜å‚¨ç®€å†æ¨¡æ¿è®¾è®¡æ•°æ® |
| 3 | `template_versions` | æ¨¡æ¿ç‰ˆæœ¬è¡¨ | å­˜å‚¨æ¨¡æ¿å†å²ç‰ˆæœ¬ |
| 4 | `source_files` | æºæ–‡ä»¶è¡¨ | å­˜å‚¨ä¸Šä¼ çš„åŸå§‹ç®€å†æ–‡ä»¶ |
| 5 | `parsed_resumes` | è§£æç»“æœè¡¨ | å­˜å‚¨AIè§£æåçš„ç»“æ„åŒ–æ•°æ® |
| 6 | `candidate_resumes` | å€™é€‰äººæ¨èæŠ¥å‘Šè¡¨ | å­˜å‚¨ç”Ÿæˆçš„è§„èŒƒåŒ–ç®€å† |
| 7 | `alembic_version` | è¿ç§»ç‰ˆæœ¬è¡¨ | Alembic æ•°æ®åº“è¿ç§»ç‰ˆæœ¬è®°å½• |

---

## ğŸ“‹ æ•°æ®è¡¨è¯¦ç»†ç»“æ„

### 1. usersï¼ˆç”¨æˆ·è¡¨ï¼‰

**ç”¨é€”**: å­˜å‚¨å¹³å°ç”¨æˆ·è´¦æˆ·ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| `id` | INTEGER | PK, NOT NULL | ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰ |
| `email` | VARCHAR(255) | UNIQUE, NOT NULL | é‚®ç®±ï¼ˆå”¯ä¸€ï¼Œç”¨äºç™»å½•ï¼‰ |
| `password_hash` | VARCHAR(255) | NOT NULL | å¯†ç å“ˆå¸Œå€¼ï¼ˆbcryptï¼‰ |
| `full_name` | VARCHAR(100) | NULL | ç”¨æˆ·å…¨å |
| `user_type` | VARCHAR(50) | NULL | ç”¨æˆ·ç±»å‹ï¼š`super_admin`, `template_designer`, `premium_user`, `trial_user` |
| `subscription_plan` | VARCHAR(50) | NULL | è®¢é˜…è®¡åˆ’ï¼š`trial`, `premium`, `enterprise` |
| `subscription_end` | TIMESTAMP | NULL | è®¢é˜…åˆ°æœŸæ—¶é—´ |
| `resume_generated_count` | INTEGER | NULL | å·²ç”Ÿæˆç®€å†æ•°é‡ï¼ˆä½¿ç”¨ç»Ÿè®¡ï¼‰ |
| `last_login` | TIMESTAMP | NULL | æœ€åç™»å½•æ—¶é—´ |
| `is_active` | BOOLEAN | NULL | è´¦æˆ·æ˜¯å¦æ¿€æ´»ï¼ˆé»˜è®¤ï¼štrueï¼‰ |
| `is_verified` | BOOLEAN | NULL | é‚®ç®±æ˜¯å¦éªŒè¯ï¼ˆé»˜è®¤ï¼šfalseï¼‰ |
| `created_at` | TIMESTAMP | NULL | åˆ›å»ºæ—¶é—´ |
| `updated_at` | TIMESTAMP | NULL | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `users_pkey` (PRIMARY KEY): `id`
- `ix_users_email` (UNIQUE): `email`
- `ix_users_id`: `id`

**å¤–é”®å…³ç³»**:
- è¢« `resume_templates.created_by` å¼•ç”¨
- è¢« `template_versions.created_by` å¼•ç”¨
- è¢« `source_files.user_id` å¼•ç”¨
- è¢« `parsed_resumes.user_id` å¼•ç”¨
- è¢« `candidate_resumes.user_id` å¼•ç”¨

---

### 2. resume_templatesï¼ˆç®€å†æ¨¡æ¿è¡¨ï¼‰

**ç”¨é€”**: å­˜å‚¨ç®€å†æ¨¡æ¿çš„è®¾è®¡æ•°æ®ï¼ˆç»„ä»¶ç»“æ„ã€æ ·å¼é…ç½®ç­‰ï¼‰

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| `id` | INTEGER | PK, NOT NULL | æ¨¡æ¿IDï¼ˆä¸»é”®ï¼‰ |
| `name` | VARCHAR(255) | NOT NULL | æ¨¡æ¿åç§° |
| `description` | TEXT | NULL | æ¨¡æ¿æè¿° |
| `template_schema` | JSON | NOT NULL | æ¨¡æ¿ç»“æ„æ•°æ®ï¼ˆç»„ä»¶é…ç½®ã€å¸ƒå±€ç­‰ï¼‰ |
| `style_config` | JSON | NULL | æ ·å¼é…ç½®ï¼ˆå­—ä½“ã€é¢œè‰²ã€é—´è·ç­‰ï¼‰ |
| `is_public` | BOOLEAN | NULL | æ˜¯å¦å…¬å¼€ï¼ˆé»˜è®¤ï¼šfalseï¼‰ |
| `is_active` | BOOLEAN | NULL | æ˜¯å¦æ¿€æ´»ï¼ˆé»˜è®¤ï¼štrueï¼‰ |
| `version` | VARCHAR(50) | NULL | ç‰ˆæœ¬å·ï¼ˆé»˜è®¤ï¼š'1.0.0'ï¼‰ |
| `parent_template_id` | INTEGER | NULL | çˆ¶æ¨¡æ¿IDï¼ˆç”¨äºç‰ˆæœ¬å…³è”ï¼‰ |
| `usage_count` | INTEGER | NULL | ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡ï¼ˆé»˜è®¤ï¼š0ï¼‰ |
| `created_by` | INTEGER | NULL | åˆ›å»ºè€…IDï¼ˆå¤–é”®ï¼šusers.idï¼‰ |
| `created_at` | TIMESTAMP | NULL | åˆ›å»ºæ—¶é—´ |
| `updated_at` | TIMESTAMP | NULL | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `resume_templates_pkey` (PRIMARY KEY): `id`
- `ix_resume_templates_id`: `id`
- `ix_resume_templates_is_public`: `is_public`
- `ix_resume_templates_is_active`: `is_active`
- `ix_resume_templates_created_by`: `created_by`
- `idx_template_public_active` (å¤åˆ): `is_public, is_active`
- `idx_template_created_by_active` (å¤åˆ): `created_by, is_active`

**å¤–é”®å…³ç³»**:
- `created_by` â†’ `users.id`
- `parent_template_id` â†’ `resume_templates.id` (è‡ªå¼•ç”¨ï¼Œç”¨äºç‰ˆæœ¬ç®¡ç†)
- è¢« `template_versions.template_id` å¼•ç”¨
- è¢« `candidate_resumes.template_id` å¼•ç”¨

---

### 3. template_versionsï¼ˆæ¨¡æ¿ç‰ˆæœ¬è¡¨ï¼‰

**ç”¨é€”**: å­˜å‚¨æ¨¡æ¿çš„å†å²ç‰ˆæœ¬å¿«ç…§ï¼Œæ”¯æŒç‰ˆæœ¬å›æ»šå’Œå¯¹æ¯”

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| `id` | INTEGER | PK, NOT NULL | ç‰ˆæœ¬IDï¼ˆä¸»é”®ï¼‰ |
| `template_id` | INTEGER | NOT NULL | æ¨¡æ¿IDï¼ˆå¤–é”®ï¼šresume_templates.idï¼‰ |
| `version` | VARCHAR(50) | NOT NULL | ç‰ˆæœ¬å·ï¼ˆå¦‚ "1.0.0", "1.1.0"ï¼‰ |
| `version_name` | VARCHAR(255) | NULL | ç‰ˆæœ¬åç§°/æè¿° |
| `template_schema` | JSON | NOT NULL | æ¨¡æ¿ç»“æ„å¿«ç…§ |
| `style_config` | JSON | NULL | æ ·å¼é…ç½®å¿«ç…§ |
| `created_by` | INTEGER | NULL | åˆ›å»ºè€…IDï¼ˆå¤–é”®ï¼šusers.idï¼‰ |
| `created_at` | TIMESTAMP | NULL | åˆ›å»ºæ—¶é—´ï¼ˆé»˜è®¤ï¼šnow()ï¼‰ |

**ç´¢å¼•**:
- `template_versions_pkey` (PRIMARY KEY): `id`
- `ix_template_versions_id`: `id`
- `ix_template_versions_template_id`: `template_id`
- `ix_template_versions_created_at`: `created_at`

**å¤–é”®å…³ç³»**:
- `template_id` â†’ `resume_templates.id`
- `created_by` â†’ `users.id`

---

### 4. source_filesï¼ˆæºæ–‡ä»¶è¡¨ï¼‰

**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„åŸå§‹ç®€å†æ–‡ä»¶ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| `id` | INTEGER | PK, NOT NULL | æ–‡ä»¶IDï¼ˆä¸»é”®ï¼‰ |
| `user_id` | INTEGER | NOT NULL | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼šusers.idï¼‰ |
| `file_name` | VARCHAR(255) | NOT NULL | åŸå§‹æ–‡ä»¶å |
| `file_type` | VARCHAR(100) | NULL | æ–‡ä»¶ç±»å‹ï¼ˆMIMEç±»å‹ï¼Œå¦‚ application/pdfï¼‰ |
| `file_path` | VARCHAR(500) | NOT NULL | æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰ |
| `file_size` | INTEGER | NULL | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| `file_hash` | VARCHAR(64) | NULL | æ–‡ä»¶å†…å®¹çš„MD5å“ˆå¸Œå€¼ï¼ˆç”¨äºå»é‡ï¼‰ |
| `created_at` | TIMESTAMP | NULL | åˆ›å»ºæ—¶é—´ï¼ˆé»˜è®¤ï¼šnow()ï¼‰ |
| `updated_at` | TIMESTAMP | NULL | æ›´æ–°æ—¶é—´ï¼ˆé»˜è®¤ï¼šnow()ï¼‰ |

**ç´¢å¼•**:
- `source_files_pkey` (PRIMARY KEY): `id`
- `ix_source_files_id`: `id`
- `ix_source_files_user_id`: `user_id`
- `ix_source_files_file_hash`: `file_hash`
- `idx_source_file_user_created` (å¤åˆ): `user_id, created_at`

**å¤–é”®å…³ç³»**:
- `user_id` â†’ `users.id`

**è¯´æ˜**:
- `file_hash` ç”¨äºæ£€æµ‹é‡å¤ä¸Šä¼ ï¼Œç›¸åŒæ–‡ä»¶åªå­˜å‚¨ä¸€æ¬¡
- æ–‡ä»¶å®é™…å­˜å‚¨åœ¨æœåŠ¡å™¨çš„ `uploads/` ç›®å½•

---

### 5. parsed_resumesï¼ˆè§£æç»“æœè¡¨ï¼‰

**ç”¨é€”**: å­˜å‚¨AIè§£æåçš„ç»“æ„åŒ–ç®€å†æ•°æ®

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| `id` | INTEGER | PK, NOT NULL | è§£æç»“æœIDï¼ˆä¸»é”®ï¼‰ |
| `user_id` | INTEGER | NOT NULL | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼šusers.idï¼‰ |
| `name` | VARCHAR(255) | NOT NULL | è§£æç»“æœåç§°ï¼ˆå¦‚"æå›½é›„è¯¦ç»†è§£æç»“æœ"ï¼‰ |
| `parsed_data` | JSON | NOT NULL | è§£æåçš„ç»“æ„åŒ–æ•°æ®ï¼ˆåŸºæœ¬ä¿¡æ¯ã€å·¥ä½œç»å†ã€æ•™è‚²èƒŒæ™¯ç­‰ï¼‰ |
| `raw_text` | TEXT | NULL | åŸå§‹æ–‡æœ¬å†…å®¹ï¼ˆå¯é€‰ï¼Œç”¨äºè°ƒè¯•ï¼‰ |
| `candidate_name` | VARCHAR(255) | NULL | å€™é€‰äººå§“åï¼ˆä»è§£ææ•°æ®ä¸­æå–ï¼‰ |
| `source_file_name` | VARCHAR(255) | NULL | æºæ–‡ä»¶å |
| `source_file_type` | VARCHAR(100) | NULL | æºæ–‡ä»¶ç±»å‹ |
| `source_file_path` | VARCHAR(500) | NULL | æºæ–‡ä»¶è·¯å¾„ |
| `file_hash` | VARCHAR(64) | NULL | æ–‡ä»¶å“ˆå¸Œå€¼ï¼ˆç”¨äºå»é‡å’Œç¼“å­˜ï¼‰ |
| `validation` | JSON | NULL | æ•°æ®éªŒè¯ç»“æœ |
| `correction` | JSON | NULL | æ•°æ®çº é”™ç»“æœ |
| `quality_analysis` | JSON | NULL | è´¨é‡åˆ†æç»“æœ |
| `created_at` | TIMESTAMP | NULL | åˆ›å»ºæ—¶é—´ï¼ˆé»˜è®¤ï¼šnow()ï¼‰ |
| `updated_at` | TIMESTAMP | NULL | æ›´æ–°æ—¶é—´ï¼ˆé»˜è®¤ï¼šnow()ï¼‰ |

**ç´¢å¼•**:
- `parsed_resumes_pkey` (PRIMARY KEY): `id`
- `ix_parsed_resumes_id`: `id`
- `ix_parsed_resumes_user_id`: `user_id`
- `ix_parsed_resumes_file_hash`: `file_hash`
- `ix_parsed_resumes_created_at`: `created_at`
- `idx_parsed_user_created` (å¤åˆ): `user_id, created_at`

**å¤–é”®å…³ç³»**:
- `user_id` â†’ `users.id`
- è¢« `candidate_resumes.parsed_resume_id` å¼•ç”¨

**è¯´æ˜**:
- `parsed_data` åŒ…å«å®Œæ•´çš„ç»“æ„åŒ–æ•°æ®ï¼Œæ ¼å¼å‚è€ƒ `å„ç»„ä»¶å…ƒæ•°æ®é…ç½®.md`
- `file_hash` ç”¨äºç¼“å­˜å’Œå»é‡ï¼Œç›¸åŒæ–‡ä»¶ä¸ä¼šé‡å¤è§£æ

---

### 6. candidate_resumesï¼ˆå€™é€‰äººæ¨èæŠ¥å‘Šè¡¨ï¼‰

**ç”¨é€”**: å­˜å‚¨ç”Ÿæˆçš„è§„èŒƒåŒ–ç®€å†ï¼ˆä½¿ç”¨æ¨¡æ¿å¡«å……åçš„å®Œæ•´ç®€å†ï¼‰

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| `id` | INTEGER | PK, NOT NULL | ç®€å†IDï¼ˆä¸»é”®ï¼‰ |
| `user_id` | INTEGER | NOT NULL | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼šusers.idï¼‰ |
| `parsed_resume_id` | INTEGER | NULL | å…³è”çš„è§£æç»“æœIDï¼ˆå¤–é”®ï¼šparsed_resumes.idï¼‰ |
| `template_id` | INTEGER | NULL | ä½¿ç”¨çš„æ¨¡æ¿IDï¼ˆå¤–é”®ï¼šresume_templates.idï¼‰ |
| `resume_data` | JSON | NOT NULL | å¡«å……åçš„ç®€å†æ•°æ®ï¼ˆåŒ…å«æ¨¡æ¿ç»“æ„ï¼‰ |
| `candidate_name` | VARCHAR(255) | NULL | å€™é€‰äººå§“åï¼ˆä¾¿äºå¿«é€Ÿè¯†åˆ«ï¼‰ |
| `source_file_name` | VARCHAR(255) | NULL | æºæ–‡ä»¶åï¼ˆä¿ç•™ï¼Œä¾¿äºå¿«é€ŸæŸ¥çœ‹ï¼‰ |
| `source_file_type` | VARCHAR(100) | NULL | æºæ–‡ä»¶ç±»å‹ |
| `source_file_path` | VARCHAR(500) | NULL | æºæ–‡ä»¶è·¯å¾„ |
| `title` | VARCHAR(255) | NULL | ç®€å†æ ‡é¢˜ï¼ˆé»˜è®¤ï¼š"æˆ‘çš„ç®€å†"ï¼‰ |
| `version` | VARCHAR(50) | NULL | ç®€å†ç‰ˆæœ¬ï¼ˆé»˜è®¤ï¼š"1.0"ï¼‰ |
| `created_at` | TIMESTAMP | NULL | åˆ›å»ºæ—¶é—´ |
| `updated_at` | TIMESTAMP | NULL | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**:
- `user_resumes_pkey` (PRIMARY KEY): `id`
- `ix_user_resumes_id`: `id`
- `ix_user_resumes_user_id`: `user_id`
- `ix_user_resumes_template_id`: `template_id`
- `ix_user_resumes_created_at`: `created_at`
- `idx_resume_user_created` (å¤åˆ): `user_id, created_at`

**å¤–é”®å…³ç³»**:
- `user_id` â†’ `users.id`
- `parsed_resume_id` â†’ `parsed_resumes.id` (ON DELETE SET NULL)
- `template_id` â†’ `resume_templates.id`

**è¯´æ˜**:
- è¿™æ˜¯æœ€ç»ˆç”Ÿæˆçš„ç®€å†ï¼Œå¯ä»¥å¯¼å‡ºä¸ºWordæ–‡æ¡£
- `resume_data` åŒ…å«å®Œæ•´çš„æ¨¡æ¿ç»“æ„å’Œå¡«å……çš„æ•°æ®
- ä¸€ä¸ªè§£æç»“æœå¯ä»¥ç”Ÿæˆå¤šä¸ªæ¨èæŠ¥å‘Šï¼ˆä½¿ç”¨ä¸åŒæ¨¡æ¿ï¼‰

---

## ğŸ”— æ•°æ®è¡¨å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users    â”‚ (ç”¨æˆ·è¡¨)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                             â”‚
       â”‚                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ resume_templates â”‚                    â”‚    source_files      â”‚
â”‚  (ç®€å†æ¨¡æ¿è¡¨)    â”‚                    â”‚    (æºæ–‡ä»¶è¡¨)         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚
       â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚template_versionsâ”‚  â”‚  â”‚   parsed_resumes      â”‚
â”‚ (æ¨¡æ¿ç‰ˆæœ¬è¡¨)     â”‚  â”‚  â”‚   (è§£æç»“æœè¡¨)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚             â”‚
                     â”‚             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
              â”‚   candidate_resumes       â”‚
              â”‚  (å€™é€‰äººæ¨èæŠ¥å‘Šè¡¨)         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³ç³»è¯´æ˜

1. **ç”¨æˆ· â†’ æ¨¡æ¿**: ä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºå¤šä¸ªæ¨¡æ¿ï¼ˆ`resume_templates.created_by`ï¼‰
2. **ç”¨æˆ· â†’ æºæ–‡ä»¶**: ä¸€ä¸ªç”¨æˆ·å¯ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼ˆ`source_files.user_id`ï¼‰
3. **ç”¨æˆ· â†’ è§£æç»“æœ**: ä¸€ä¸ªç”¨æˆ·å¯æœ‰å¤šä¸ªè§£æç»“æœï¼ˆ`parsed_resumes.user_id`ï¼‰
4. **ç”¨æˆ· â†’ æ¨èæŠ¥å‘Š**: ä¸€ä¸ªç”¨æˆ·å¯ç”Ÿæˆå¤šä¸ªæ¨èæŠ¥å‘Šï¼ˆ`candidate_resumes.user_id`ï¼‰
5. **æ¨¡æ¿ â†’ æ¨¡æ¿ç‰ˆæœ¬**: ä¸€ä¸ªæ¨¡æ¿å¯æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆ`template_versions.template_id`ï¼‰
6. **æ¨¡æ¿ â†’ æ¨èæŠ¥å‘Š**: ä¸€ä¸ªæ¨¡æ¿å¯ç”¨äºå¤šä¸ªæ¨èæŠ¥å‘Šï¼ˆ`candidate_resumes.template_id`ï¼‰
7. **è§£æç»“æœ â†’ æ¨èæŠ¥å‘Š**: ä¸€ä¸ªè§£æç»“æœå¯ç”Ÿæˆå¤šä¸ªæ¨èæŠ¥å‘Šï¼ˆ`candidate_resumes.parsed_resume_id`ï¼‰
8. **æ¨¡æ¿è‡ªå¼•ç”¨**: æ¨¡æ¿å¯ä»¥æœ‰çˆ¶æ¨¡æ¿ï¼ˆç‰ˆæœ¬ç®¡ç†ï¼Œ`resume_templates.parent_template_id`ï¼‰

---

## ğŸ“Š æ•°æ®æµè½¬å…³ç³»

### ä¸šåŠ¡æµç¨‹

```
1. ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
   â””â”€> source_files (ä¿å­˜æ–‡ä»¶ä¿¡æ¯)

2. AIè§£ææ–‡ä»¶
   â””â”€> parsed_resumes (ä¿å­˜è§£æç»“æœ)
       â””â”€> å…³è” source_files (é€šè¿‡ file_hash)

3. ç”¨æˆ·é€‰æ‹©æ¨¡æ¿
   â””â”€> resume_templates (è·å–æ¨¡æ¿ç»“æ„)

4. ç”Ÿæˆæ¨èæŠ¥å‘Š
   â””â”€> candidate_resumes (ä¿å­˜å®Œæ•´ç®€å†)
       â”œâ”€> å…³è” parsed_resumes (æ•°æ®æ¥æº)
       â””â”€> å…³è” resume_templates (æ¨¡æ¿ç»“æ„)
```

---

## ğŸ” ç´¢å¼•ä¼˜åŒ–è¯´æ˜

### å•åˆ—ç´¢å¼•
- **ç”¨æˆ·ç›¸å…³**: `user_id` ç´¢å¼•ç”¨äºå¿«é€ŸæŸ¥è¯¢ç”¨æˆ·çš„æ•°æ®
- **æ—¶é—´ç›¸å…³**: `created_at` ç´¢å¼•ç”¨äºæŒ‰æ—¶é—´æ’åº
- **æ–‡ä»¶å»é‡**: `file_hash` ç´¢å¼•ç”¨äºå¿«é€ŸæŸ¥æ‰¾é‡å¤æ–‡ä»¶

### å¤åˆç´¢å¼•
- **ç”¨æˆ·+æ—¶é—´**: `(user_id, created_at)` ç”¨äºæŸ¥è¯¢ç”¨æˆ·çš„æ•°æ®åˆ—è¡¨å¹¶æŒ‰æ—¶é—´æ’åº
- **æ¨¡æ¿æŸ¥è¯¢**: `(is_public, is_active)` ç”¨äºæŸ¥è¯¢å…¬å¼€ä¸”æ´»è·ƒçš„æ¨¡æ¿
- **ç”¨æˆ·æ¨¡æ¿**: `(created_by, is_active)` ç”¨äºæŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„æ´»è·ƒæ¨¡æ¿

---

## ğŸ“ JSON å­—æ®µç»“æ„è¯´æ˜

### resume_templates.template_schema
```json
{
  "components": [
    {
      "id": "comp_1",
      "type": "work_experience",
      "title": "å·¥ä½œç»å†",
      "config": {...},
      "fields": [...]
    }
  ]
}
```

### parsed_resumes.parsed_data
```json
{
  "basic_info": {
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "email": "zhangsan@example.com"
  },
  "work_experiences": [...],
  "education": [...],
  "skills": {...},
  "projects": [...]
}
```

### candidate_resumes.resume_data
```json
{
  "_template_structure": {...},
  "basic_info": {...},
  "work_experiences": [...],
  "education": [...],
  ...
}
```

---

## ğŸ” æ•°æ®å®Œæ•´æ€§çº¦æŸ

### å¤–é”®çº¦æŸ
- æ‰€æœ‰å¤–é”®éƒ½è®¾ç½®äº†é€‚å½“çš„çº¦æŸ
- `candidate_resumes.parsed_resume_id` ä½¿ç”¨ `ON DELETE SET NULL`ï¼Œåˆ é™¤è§£æç»“æœæ—¶ä¸ä¼šçº§è”åˆ é™¤æ¨èæŠ¥å‘Š

### å”¯ä¸€æ€§çº¦æŸ
- `users.email` å”¯ä¸€ï¼Œç¡®ä¿é‚®ç®±ä¸é‡å¤

### éç©ºçº¦æŸ
- å…³é”®å­—æ®µè®¾ç½®äº† NOT NULL çº¦æŸ
- JSON å­—æ®µï¼ˆå¦‚ `template_schema`, `parsed_data`, `resume_data`ï¼‰ä¸º NOT NULL

---

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡æŸ¥è¯¢ç¤ºä¾‹

### ç”¨æˆ·æ•°æ®ç»Ÿè®¡
```sql
-- ç”¨æˆ·æ€»æ•°
SELECT COUNT(*) FROM users;

-- æ´»è·ƒç”¨æˆ·æ•°
SELECT COUNT(*) FROM users WHERE is_active = true;

-- ç”¨æˆ·ç”Ÿæˆçš„ç®€å†æ•°
SELECT user_id, COUNT(*) as resume_count 
FROM candidate_resumes 
GROUP BY user_id;
```

### æ¨¡æ¿ä½¿ç”¨ç»Ÿè®¡
```sql
-- æ¨¡æ¿ä½¿ç”¨æ¬¡æ•°
SELECT template_id, COUNT(*) as usage_count 
FROM candidate_resumes 
GROUP BY template_id;

-- æœ€å—æ¬¢è¿çš„æ¨¡æ¿
SELECT t.name, COUNT(cr.id) as usage_count
FROM resume_templates t
LEFT JOIN candidate_resumes cr ON t.id = cr.template_id
GROUP BY t.id, t.name
ORDER BY usage_count DESC;
```

### è§£æç»“æœç»Ÿè®¡
```sql
-- è§£ææˆåŠŸç‡ï¼ˆæœ‰è§£æç»“æœçš„æ–‡ä»¶æ•° / æ€»æ–‡ä»¶æ•°ï¼‰
SELECT 
  (SELECT COUNT(*) FROM parsed_resumes)::float / 
  (SELECT COUNT(*) FROM source_files)::float * 100 as success_rate;
```

---

## ğŸ¯ æ•°æ®è¡¨è®¾è®¡è¯„ä»·

### âœ… ä¼˜ç‚¹
1. **è§„èŒƒåŒ–è®¾è®¡**: è¡¨ç»“æ„æ¸…æ™°ï¼Œç¬¦åˆæ•°æ®åº“è®¾è®¡è§„èŒƒ
2. **ç´¢å¼•ä¼˜åŒ–**: é’ˆå¯¹å¸¸ç”¨æŸ¥è¯¢æ·»åŠ äº†åˆé€‚çš„ç´¢å¼•
3. **ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒæ¨¡æ¿ç‰ˆæœ¬å†å²è®°å½•
4. **å»é‡æœºåˆ¶**: ä½¿ç”¨ `file_hash` é¿å…é‡å¤å­˜å‚¨
5. **å…³è”å®Œæ•´**: å¤–é”®å…³ç³»æ¸…æ™°ï¼Œæ•°æ®ä¸€è‡´æ€§æœ‰ä¿éšœ

### âš ï¸ æ”¹è¿›å»ºè®®
1. **è½¯åˆ é™¤**: è€ƒè™‘æ·»åŠ  `deleted_at` å­—æ®µï¼Œæ”¯æŒè½¯åˆ é™¤
2. **å®¡è®¡æ—¥å¿—**: è€ƒè™‘æ·»åŠ æ“ä½œæ—¥å¿—è¡¨ï¼Œè®°å½•é‡è¦æ“ä½œ
3. **æ•°æ®å½’æ¡£**: è€ƒè™‘æ·»åŠ å½’æ¡£æœºåˆ¶ï¼Œå¤„ç†å†å²æ•°æ®
4. **åˆ†åŒºè¡¨**: å¦‚æœæ•°æ®é‡å¤§ï¼Œè€ƒè™‘æŒ‰æ—¶é—´åˆ†åŒº

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-12-05

