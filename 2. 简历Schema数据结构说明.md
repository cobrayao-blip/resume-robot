# 简历Schema数据结构说明

本文档详细说明了 `ResumeData`、`ParsedResumeCreate`、`ParsedResumeResponse` 三个 Pydantic Schema 的完整数据结构。

## 一、ResumeData

### 定义位置
`backend/app/schemas/resume.py`

### 用途
用于简历生成和填充的数据结构，包含结构化的简历信息。

### 完整结构

```python
class ResumeData(BaseModel):
    basic_info: Dict[str, Any]
    work_experiences: List[Dict[str, Any]]
    education: List[Dict[str, Any]]
    skills: Dict[str, Any]
    projects: List[Dict[str, Any]]
    # 可选扩展：推荐岗位、评价、薪资
    recommended_jobs: Optional[List[Dict[str, Any]]] = None
    evaluation: Optional[Dict[str, Any]] = None
    salary: Optional[Dict[str, Any]] = None
```

### 字段说明

| 字段名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `basic_info` | `Dict[str, Any]` | ✅ 是 | - | 基本信息对象 |
| `work_experiences` | `List[Dict[str, Any]]` | ✅ 是 | - | 工作经历数组 |
| `education` | `List[Dict[str, Any]]` | ✅ 是 | - | 教育背景数组 |
| `skills` | `Dict[str, Any]` | ✅ 是 | - | 技能专长对象 |
| `projects` | `List[Dict[str, Any]]` | ✅ 是 | - | 项目经历数组 |
| `recommended_jobs` | `Optional[List[Dict[str, Any]]]` | ❌ 否 | `None` | 推荐岗位数组（可选） |
| `evaluation` | `Optional[Dict[str, Any]]` | ❌ 否 | `None` | 评价信息对象（可选） |
| `salary` | `Optional[Dict[str, Any]]` | ❌ 否 | `None` | 薪资信息对象（可选） |

### 嵌套结构说明

#### 1. basic_info（基本信息）

```typescript
{
  name: string,              // 姓名
  phone: string,             // 电话
  email: string,            // 邮箱
  location: string,         // 所在地
  gender?: string,          // 性别（可选）
  birth_date?: string,      // 出生日期（可选）
  birthday?: string,       // 出生日期（兼容字段，可选）
  hometown?: string,        // 籍贯（可选）
  marital_status?: string,  // 婚育状态（可选）
  family_location?: string, // 家庭所在地（可选）
  current_location?: string, // 现工作地（可选）
  current_work_location?: string, // 现工作地（兼容字段，可选）
  wechat?: string,         // 微信号（可选）
  onboard_date?: string,   // 入职时间（可选）
  other_info?: string      // 其他信息（可选）
}
```

#### 2. work_experiences（工作经历数组）

```typescript
[
  {
    company: string,              // 公司名称
    position: string,             // 职位名称
    location?: string,             // 工作地点（可选）
    start_date: string,            // 开始时间（YYYY-MM）
    end_date?: string,            // 结束时间（YYYY-MM，可选）
    is_current: boolean,          // 是否当前工作
    report_to?: string,           // 汇报对象（可选）
    team_size?: string,           // 团队规模（可选）
    responsibilities: string[],    // 工作职责数组
    achievements: string[],        // 工作业绩数组
    reason_for_leaving?: string   // 离职原因（可选）
  }
]
```

#### 3. education（教育背景数组）

```typescript
[
  {
    school: string,              // 学校名称
    major: string,               // 专业
    education_level: string,     // 学历层次（本科、研究生、专科等）
    degree?: string,             // 学位（学士、硕士、博士等，可选）
    start_date?: string,         // 入学时间（可选）
    graduation_date?: string     // 毕业时间（可选）
  }
]
```

#### 4. skills（技能专长对象）

```typescript
{
  technical: string[],   // 技术技能数组
  soft: string[],        // 软技能数组
  languages: string[]    // 语言能力数组
}
```

#### 5. projects（项目经历数组）

```typescript
[
  {
    name: string,                 // 项目名称
    role?: string,                // 项目角色（可选）
    start_date?: string,          // 项目开始时间（可选）
    end_date?: string,            // 项目结束时间（可选）
    description: string,          // 项目完整描述
    responsibilities?: string[],   // 项目职责数组（可选）
    achievements?: string[],       // 项目业绩数组（可选）
    related_work?: string,        // 关联工作（可选）
    outcome?: string              // 项目成果（可选，兼容字段）
  }
]
```

#### 6. recommended_jobs（推荐岗位数组，可选）

```typescript
[
  {
    job_title: string,      // 岗位名称
    company: string,         // 公司名称
    location?: string,       // 工作地点（可选）
    match_score?: number,    // 匹配度（可选）
    // ... 其他字段
  }
]
```

#### 7. evaluation（评价信息对象，可选）

```typescript
{
  professional_summary?: string,  // 职业摘要（可选）
  core_competencies?: string[],  // 核心能力数组（可选）
  // ... 其他评价字段
}
```

#### 8. salary（薪资信息对象，可选）

```typescript
{
  expected_salary?: string,   // 期望薪资（可选）
  current_salary?: string,    // 当前薪资（可选）
  salary_range?: string,      // 薪资范围（可选）
  currency?: string           // 币种（可选）
}
```

### JSON示例

```json
{
  "basic_info": {
    "name": "张三",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "location": "北京",
    "gender": "男",
    "birth_date": "1990-05",
    "hometown": "山东",
    "current_location": "北京"
  },
  "work_experiences": [
    {
      "company": "中国建筑第八工程局有限公司",
      "position": "业务经理",
      "location": "北京",
      "start_date": "2019-04",
      "end_date": "2022-06",
      "is_current": false,
      "report_to": "部门总监",
      "team_size": "10人",
      "responsibilities": [
        "负责项目投融资工作",
        "管理金融产品开发和推广"
      ],
      "achievements": [
        "完成XX项目，获得XX奖励"
      ]
    }
  ],
  "education": [
    {
      "school": "清华大学",
      "major": "计算机科学与技术",
      "education_level": "本科",
      "degree": "学士",
      "graduation_date": "2020-06"
    }
  ],
  "skills": {
    "technical": ["Java", "Python", "Spring Boot"],
    "soft": ["团队协作", "沟通能力"],
    "languages": ["英语（CET-6）"]
  },
  "projects": [
    {
      "name": "XX系统开发",
      "role": "项目经理",
      "start_date": "2020-01",
      "end_date": "2021-06",
      "description": "负责XX系统的整体架构设计和开发",
      "responsibilities": [
        "负责系统架构设计",
        "管理开发团队"
      ],
      "achievements": [
        "完成XX功能，获得XX奖励"
      ]
    }
  ],
  "recommended_jobs": null,
  "evaluation": null,
  "salary": null
}
```

---

## 二、ParsedResumeCreate

### 定义位置
`backend/app/schemas/resume.py`

### 用途
用于创建解析结果（ParsedResume）的请求数据结构。

### 完整结构

```python
class ParsedResumeCreate(BaseModel):
    name: str
    parsed_data: Dict[str, Any]
    raw_text: Optional[str] = None
    candidate_name: Optional[str] = None
    source_file_name: Optional[str] = None
    source_file_type: Optional[str] = None
    source_file_path: Optional[str] = None
    file_hash: Optional[str] = None
    validation: Optional[Dict[str, Any]] = None
    correction: Optional[Dict[str, Any]] = None
    quality_analysis: Optional[Dict[str, Any]] = None
```

### 字段说明

| 字段名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| `name` | `str` | ✅ 是 | - | 解析结果名称（如"李国雄详细解析结果"） |
| `parsed_data` | `Dict[str, Any]` | ✅ 是 | - | **解析后的JSON数据**（包含 basic_info、work_experiences、education、skills、projects 等） |
| `raw_text` | `Optional[str]` | ❌ 否 | `None` | 原始文本内容（用于调试） |
| `candidate_name` | `Optional[str]` | ❌ 否 | `None` | 候选人姓名（如果不提供则从 parsed_data.basic_info.name 提取） |
| `source_file_name` | `Optional[str]` | ❌ 否 | `None` | 源文件名 |
| `source_file_type` | `Optional[str]` | ❌ 否 | `None` | 源文件类型（PDF、Word等） |
| `source_file_path` | `Optional[str]` | ❌ 否 | `None` | 源文件存储路径 |
| `file_hash` | `Optional[str]` | ❌ 否 | `None` | 文件内容的MD5 hash（用于去重） |
| `validation` | `Optional[Dict[str, Any]]` | ❌ 否 | `None` | 验证结果（数据验证信息） |
| `correction` | `Optional[Dict[str, Any]]` | ❌ 否 | `None` | 纠错结果（数据纠错信息） |
| `quality_analysis` | `Optional[Dict[str, Any]]` | ❌ 否 | `None` | 质量分析结果（数据质量评估） |

### parsed_data 结构

`parsed_data` 字段存储的是完整的解析结果JSON，结构与 `ResumeData` 类似，但可能包含更多元数据：

```json
{
  "basic_info": { ... },
  "work_experiences": [ ... ],
  "education": [ ... ],
  "skills": { ... },
  "projects": [ ... ],
  "_metadata": {
    "parsing_version": "2.0"
  }
}
```

### JSON示例

```json
{
  "name": "李国雄详细解析结果",
  "parsed_data": {
    "basic_info": {
      "name": "李国雄",
      "phone": "13800138000",
      "email": "liguoxiong@example.com",
      "location": "北京"
    },
    "work_experiences": [
      {
        "company": "XX公司",
        "position": "软件工程师",
        "start_date": "2020-01",
        "end_date": "2023-06",
        "is_current": false,
        "responsibilities": ["负责系统开发"],
        "achievements": ["完成XX项目"]
      }
    ],
    "education": [
      {
        "school": "清华大学",
        "major": "计算机科学与技术",
        "education_level": "本科",
        "degree": "学士"
      }
    ],
    "skills": {
      "technical": ["Java", "Python"],
      "soft": ["团队协作"],
      "languages": ["英语"]
    },
    "projects": [
      {
        "name": "XX系统",
        "description": "项目描述"
      }
    ],
    "_metadata": {
      "parsing_version": "2.0"
    }
  },
  "raw_text": "李国雄\n13800138000\n...",
  "candidate_name": "李国雄",
  "source_file_name": "李国雄_简历.pdf",
  "source_file_type": "pdf",
  "source_file_path": "uploads/2024/01/xxx.pdf",
  "file_hash": "abc123def456...",
  "validation": {
    "is_valid": true,
    "errors": []
  },
  "correction": {
    "corrected_fields": []
  },
  "quality_analysis": {
    "completeness_score": 0.95,
    "quality_level": "high"
  }
}
```

---

## 三、ParsedResumeResponse

### 定义位置
`backend/app/schemas/resume.py`

### 用途
用于返回解析结果（ParsedResume）的响应数据结构，包含数据库记录的所有字段。

### 完整结构

```python
class ParsedResumeResponse(BaseModel):
    id: int
    user_id: int
    name: str
    parsed_data: Dict[str, Any]
    raw_text: Optional[str] = None
    candidate_name: Optional[str] = None
    source_file_name: Optional[str] = None
    source_file_type: Optional[str] = None
    source_file_path: Optional[str] = None
    file_hash: Optional[str] = None
    validation: Optional[Dict[str, Any]] = None
    correction: Optional[Dict[str, Any]] = None
    quality_analysis: Optional[Dict[str, Any]] = None
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True
```

### 字段说明

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `id` | `int` | ✅ 是 | 解析结果ID（主键） |
| `user_id` | `int` | ✅ 是 | 用户ID（关联users表） |
| `name` | `str` | ✅ 是 | 解析结果名称 |
| `parsed_data` | `Dict[str, Any]` | ✅ 是 | **解析后的JSON数据** |
| `raw_text` | `Optional[str]` | ❌ 否 | 原始文本内容 |
| `candidate_name` | `Optional[str]` | ❌ 否 | 候选人姓名 |
| `source_file_name` | `Optional[str]` | ❌ 否 | 源文件名 |
| `source_file_type` | `Optional[str]` | ❌ 否 | 源文件类型 |
| `source_file_path` | `Optional[str]` | ❌ 否 | 源文件存储路径 |
| `file_hash` | `Optional[str]` | ❌ 否 | 文件内容的MD5 hash |
| `validation` | `Optional[Dict[str, Any]]` | ❌ 否 | 验证结果 |
| `correction` | `Optional[Dict[str, Any]]` | ❌ 否 | 纠错结果 |
| `quality_analysis` | `Optional[Dict[str, Any]]` | ❌ 否 | 质量分析结果 |
| `created_at` | `datetime` | ✅ 是 | 创建时间 |
| `updated_at` | `datetime` | ✅ 是 | 更新时间 |

### 与 ParsedResumeCreate 的区别

`ParsedResumeResponse` 比 `ParsedResumeCreate` 多出以下字段：
- `id`: 数据库主键
- `user_id`: 用户ID
- `created_at`: 创建时间
- `updated_at`: 更新时间

### JSON示例

```json
{
  "id": 1,
  "user_id": 10,
  "name": "李国雄详细解析结果",
  "parsed_data": {
    "basic_info": {
      "name": "李国雄",
      "phone": "13800138000",
      "email": "liguoxiong@example.com",
      "location": "北京"
    },
    "work_experiences": [
      {
        "company": "XX公司",
        "position": "软件工程师",
        "start_date": "2020-01",
        "end_date": "2023-06",
        "is_current": false,
        "responsibilities": ["负责系统开发"],
        "achievements": ["完成XX项目"]
      }
    ],
    "education": [
      {
        "school": "清华大学",
        "major": "计算机科学与技术",
        "education_level": "本科",
        "degree": "学士"
      }
    ],
    "skills": {
      "technical": ["Java", "Python"],
      "soft": ["团队协作"],
      "languages": ["英语"]
    },
    "projects": [
      {
        "name": "XX系统",
        "description": "项目描述"
      }
    ],
    "_metadata": {
      "parsing_version": "2.0"
    }
  },
  "raw_text": "李国雄\n13800138000\n...",
  "candidate_name": "李国雄",
  "source_file_name": "李国雄_简历.pdf",
  "source_file_type": "pdf",
  "source_file_path": "uploads/2024/01/xxx.pdf",
  "file_hash": "abc123def456...",
  "validation": {
    "is_valid": true,
    "errors": []
  },
  "correction": {
    "corrected_fields": []
  },
  "quality_analysis": {
    "completeness_score": 0.95,
    "quality_level": "high"
  },
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

---

## 四、三个Schema的关系

### 数据流转

```
简历文件上传
  ↓
解析为 parsed_data（JSON结构）
  ↓
使用 ParsedResumeCreate 创建解析结果
  ↓
保存到数据库（parsed_resumes表）
  ↓
使用 ParsedResumeResponse 返回给前端
  ↓
从 parsed_data 提取数据
  ↓
转换为 ResumeData 用于简历生成
```

### 字段对应关系

| ParsedResumeCreate/Response | ResumeData | 说明 |
|----------------------------|------------|------|
| `parsed_data.basic_info` | `basic_info` | 基本信息 |
| `parsed_data.work_experiences` | `work_experiences` | 工作经历 |
| `parsed_data.education` | `education` | 教育背景 |
| `parsed_data.skills` | `skills` | 技能专长 |
| `parsed_data.projects` | `projects` | 项目经历 |
| `parsed_data.recommended_jobs` | `recommended_jobs` | 推荐岗位（可选） |
| `parsed_data.evaluation` | `evaluation` | 评价信息（可选） |
| `parsed_data.salary` | `salary` | 薪资信息（可选） |

### 使用场景

1. **ParsedResumeCreate**：
   - 用于创建解析结果的API请求
   - 前端调用 `POST /parsed-resumes/` 时使用

2. **ParsedResumeResponse**：
   - 用于返回解析结果的API响应
   - 前端调用 `GET /parsed-resumes/{id}` 时返回

3. **ResumeData**：
   - 用于简历生成和填充
   - 前端调用 `POST /resumes/` 创建简历时使用
   - 存储在 `candidate_resumes.resume_data` 字段中

---

## 五、数据库映射

### ParsedResume 表

| Schema字段 | 数据库字段 | 类型 | 说明 |
|-----------|-----------|------|------|
| `id` | `id` | Integer | 主键 |
| `user_id` | `user_id` | Integer | 外键（users.id） |
| `name` | `name` | String(255) | 解析结果名称 |
| `parsed_data` | `parsed_data` | JSON | **解析后的JSON数据** |
| `raw_text` | `raw_text` | Text | 原始文本 |
| `candidate_name` | `candidate_name` | String(255) | 候选人姓名 |
| `source_file_name` | `source_file_name` | String(255) | 源文件名 |
| `source_file_type` | `source_file_type` | String(100) | 源文件类型 |
| `source_file_path` | `source_file_path` | String(500) | 源文件路径 |
| `file_hash` | `file_hash` | String(64) | 文件哈希 |
| `validation` | `validation` | JSON | 验证结果 |
| `correction` | `correction` | JSON | 纠错结果 |
| `quality_analysis` | `quality_analysis` | JSON | 质量分析结果 |
| `created_at` | `created_at` | DateTime | 创建时间 |
| `updated_at` | `updated_at` | DateTime | 更新时间 |

---

## 六、类型定义总结

### ResumeData

```python
ResumeData = {
    basic_info: Dict[str, Any],                    # 必填
    work_experiences: List[Dict[str, Any]],       # 必填
    education: List[Dict[str, Any]],              # 必填
    skills: Dict[str, Any],                       # 必填
    projects: List[Dict[str, Any]],               # 必填
    recommended_jobs?: List[Dict[str, Any]],      # 可选
    evaluation?: Dict[str, Any],                  # 可选
    salary?: Dict[str, Any]                       # 可选
}
```

### ParsedResumeCreate

```python
ParsedResumeCreate = {
    name: str,                                     # 必填
    parsed_data: Dict[str, Any],                  # 必填（包含完整的解析结果）
    raw_text?: str,                               # 可选
    candidate_name?: str,                         # 可选
    source_file_name?: str,                       # 可选
    source_file_type?: str,                       # 可选
    source_file_path?: str,                       # 可选
    file_hash?: str,                              # 可选
    validation?: Dict[str, Any],                  # 可选
    correction?: Dict[str, Any],                  # 可选
    quality_analysis?: Dict[str, Any]             # 可选
}
```

### ParsedResumeResponse

```python
ParsedResumeResponse = {
    id: int,                                      # 必填（数据库主键）
    user_id: int,                                 # 必填（用户ID）
    name: str,                                    # 必填
    parsed_data: Dict[str, Any],                  # 必填（包含完整的解析结果）
    raw_text?: str,                               # 可选
    candidate_name?: str,                         # 可选
    source_file_name?: str,                       # 可选
    source_file_type?: str,                       # 可选
    source_file_path?: str,                       # 可选
    file_hash?: str,                              # 可选
    validation?: Dict[str, Any],                 # 可选
    correction?: Dict[str, Any],                  # 可选
    quality_analysis?: Dict[str, Any],              # 可选
    created_at: datetime,                         # 必填（创建时间）
    updated_at: datetime                          # 必填（更新时间）
}
```

---

## 七、关键字段说明

### parsed_data 字段

**重要性**：⭐⭐⭐⭐⭐

- **类型**：`Dict[str, Any]`（JSON对象）
- **存储内容**：完整的解析结果，包含 `basic_info`、`work_experiences`、`education`、`skills`、`projects` 等
- **存储位置**：
  - `parsed_resumes.parsed_data`（解析结果表）
  - 作为 `ParsedResumeCreate` 和 `ParsedResumeResponse` 的核心字段
- **用途**：
  - 存储解析后的结构化数据
  - 用于后续简历生成和填充
  - 作为数据源填充到模板中

### candidate_name 字段

**重要性**：⭐⭐⭐

- **类型**：`Optional[str]`
- **说明**：候选人姓名，用于快速识别
- **提取规则**：如果不提供，则从 `parsed_data.basic_info.name` 提取

### validation、correction、quality_analysis 字段

**重要性**：⭐⭐

- **类型**：`Optional[Dict[str, Any]]`
- **说明**：用于存储数据验证、纠错和质量分析的结果
- **用途**：帮助用户了解解析结果的质量和准确性

---

## 八、使用示例

### 1. 创建解析结果（使用 ParsedResumeCreate）

```python
parsed_resume_data = ParsedResumeCreate(
    name="李国雄详细解析结果",
    parsed_data={
        "basic_info": {
            "name": "李国雄",
            "phone": "13800138000",
            "email": "liguoxiong@example.com",
            "location": "北京"
        },
        "work_experiences": [...],
        "education": [...],
        "skills": {...},
        "projects": [...]
    },
    candidate_name="李国雄",
    source_file_name="李国雄_简历.pdf",
    source_file_type="pdf"
)
```

### 2. 返回解析结果（使用 ParsedResumeResponse）

```python
# 从数据库查询
parsed_resume = db.query(ParsedResume).filter(ParsedResume.id == 1).first()

# 转换为Response
response = ParsedResumeResponse(
    id=parsed_resume.id,
    user_id=parsed_resume.user_id,
    name=parsed_resume.name,
    parsed_data=parsed_resume.parsed_data,
    candidate_name=parsed_resume.candidate_name,
    created_at=parsed_resume.created_at,
    updated_at=parsed_resume.updated_at
)
```

### 3. 生成简历（使用 ResumeData）

```python
# 从解析结果提取数据
parsed_data = parsed_resume.parsed_data

# 转换为ResumeData
resume_data = ResumeData(
    basic_info=parsed_data["basic_info"],
    work_experiences=parsed_data["work_experiences"],
    education=parsed_data["education"],
    skills=parsed_data["skills"],
    projects=parsed_data["projects"]
)

# 创建简历
resume = ResumeCreate(
    template_id=1,
    resume_data=resume_data,
    parsed_resume_id=parsed_resume.id
)
```

---

## 九、相关文件

- **Schema定义**：`backend/app/schemas/resume.py`
- **数据库模型**：`backend/app/models/resume.py` - `ParsedResume`
- **解析服务**：`backend/app/services/llm_service.py` - `parse_resume_text_v2`
- **API端点**：
  - `backend/app/api/v1/endpoints/parsed_resumes.py` - 解析结果管理
  - `backend/app/api/v1/endpoints/resumes.py` - 简历管理

